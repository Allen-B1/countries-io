<html lang="en">
	<head>
		<title>countries.io - ffa</title>
		<link rel="stylesheet" href="/style.css">
		<style>
#error:not(:empty) {
	color: red;
	background: inherit;
	position: fixed;
	top: 0; left: 0; width: 100%; height: 100%;
}
		</style>
	</head>
	<body>
		<div id="error"></div>
		<table id="map">

		</table>
		<script>
var map = null;

var ws = new WebSocket("ws://" + location.host + "/ws/game");
ws.onmessage = function(msg) {
	if (msg.data.startsWith("update ")) {
		var data = JSON.parse(msg.data.slice("update ".length));
		map = data;
		console.log("update");
	} else if (msg.data.startsWith("map ")) {
		console.log(msg.data);
		var width = msg.data.split(" ")[1] | 0,
			height = msg.data.split(" ")[2] | 0;
		var maptable = document.getElementById("map");
		for (let i = 0; i < height; i++) {
			let row = maptable.insertRow(i);
			for (let j = 0; j < width; j++) {
				let cell = row.insertCell(j);
				cell.id = "cell-" + (i * width + j);
			}
		}
	} else {
		console.log(msg.data);
	}
}
ws.onopen = function() {
	var arr = location.hash.slice(1).split(":");
	var id = arr[0], index = arr[1];
	ws.send("join " + id + " " + index)
}
		</script>
	</body>
</html>

